{% extends "layouts/home.html" %}
{% load static %}
{% block title %}Escolas{% endblock %}

{% block page %}
Relatório de Escolas
{% endblock %}

{% block content %}
<div class="space-y-4">
    <div class="bg-white shadow rounded-lg pb-2 transition hover:shadow-md">
        <h2 class="text-lg font-semibold mb-4 flex justify-between items-center select-none cursor-pointer pl-8 pr-8 pt-5"
            data-collapse-toggle="filtros-conteudo">
            Filtros
            <!-- Ícone de seta -->
            <span class="icon-[mdi--chevron-up] w-8 h-8 text-gray-600 rotate-icon"></span>
        </h2>
        <div id="filtros-conteudo" class="hidden mt-4 mb-4 pl-8 pr-8 pt-5">
            {% csrf_token %}
            <form method="GET" id="form" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="estado" class="block text-sm font-medium mb-1">Estado</label>
                    <select class="w-full form-select rounded-lg" name="estado" id="estado" data-req-value="{{ filters.estado }}">
                        <option value="0" selected>Todos</option>
                    </select>
                </div>
                <div>
                    <label for="cidade" class="relative text-sm font-medium mb-1">Cidade</label>
                    <select class="w-full form-select rounded-lg" name="cidade" id="cidade" data-req-value="{{ filters.cidade }}">
                        <option value="0">Todos</option>
                    </select>
                </div>
                <div>
                    <label for="local" class="relative text-sm font-medium mb-1">Local</label>
                    <select class="w-full form-select rounded-lg" name="local" id="local" data-req-value="{{ filters.local }}">
                        <option value="0">Todos</option>
                    </select>
                </div>
                <div>
                    <label for="categoria" class="relative text-sm font-medium mb-1">Categoria</label>
                    <select class="w-full form-select rounded-lg" name="categoria" id="categoria" data-req-value="{{ filters.categoria }}">
                        <option value="0">Todos</option>
                    </select>
                </div>
                <div>
                    <label for="nome" class="relative text-sm font-medium mb-1">Nome</label>
                    <div class="flex w-full">
                    {% with op=filters.nome_op|default:"0" %}
                    <select
                        name="nome_op"
                        id="nome_op"
                        class="w-36 rounded-l-lg border px-3 text-sm bg-white
                            focus:outline-none focus:ring-1 focus:ring-primary"
                    >
                        <option value="0" {% if op == "0" %}selected{% endif %}>Igual</option>
                        <option value="1" {% if op == "1" %}selected{% endif %}>Contém</option>
                        <option value="2" {% if op == "2" %}selected{% endif %}>Diferente</option>
                    </select>
                    {% endwith %}
                        <input
                            type="text"
                            name="nome"
                            id="nome"
                            maxlength="255"
                            value="{{ filters.nome }}"
                            data-req-value="{{ filters.nome }}"
                            class="w-full rounded-r-lg border px-3 focus:outline-none focus:ring-1 focus:ring-primary border-s-0"
                        >
                    </div>
                </div>
                <div>
                    <label for="escola" class="relative text-sm font-medium mb-1">ID Escola</label>
                    <div class="flex w-full">
                    {% with op=filters.escola_op|default:"0" %}
                    <select
                        name="escola_op"
                        id="escola_op"
                        class="w-36 rounded-l-lg border px-3 text-sm bg-white
                            focus:outline-none focus:ring-1 focus:ring-primary"
                    >
                        <option value="0" {% if op == "0" %}selected{% endif %}>Igual</option>
                        <option value="1" {% if op == "1" %}selected{% endif %}>Contém</option>
                        <option value="2" {% if op == "2" %}selected{% endif %}>Diferente</option>
                    </select>
                    {% endwith %}
                        <input
                            type="text"
                            name="escola"
                            id="escola"
                            maxlength="255"
                            value="{{ filters.escola }}"
                            data-req-value="{{ filters.escola }}"
                            class="w-full rounded-r-lg border px-3 focus:outline-none focus:ring-1 focus:ring-primary border-s-0"
                        >
                    </div>
                </div>
                <div class="md:col-span-3 flex justify-end">
                    <button id="form-button" type="submit"
                        class="px-4 py-2 bg-cyan-900 text-white rounded-lg hover:bg-cyan-800 transition cursor-pointer disabled:opacity-75 disabled:hover:bg-cyan-900 disabled:cursor-not-allowed">
                        Aplicar Filtros
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="flex-1 bg-white shadow rounded-lg overflow-hidden p-8 mb-8">
        <!-- Cabeçalho -->
        <div class="pb-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold">Resultados</h2>
        </div>
        <!-- Conteúdo com scroll -->
        <div class="overflow-y-auto h-full">
            <div class="relative overflow-x-auto bg-neutral-primary-soft shadow-xs rounded-base border border-default">
                <table class="w-full text-sm text-left rtl:text-right text-body">
                    <thead class="text-sm text-body bg-neutral-secondary-medium border-b border-default-medium">
                        <tr>
                            <th scope="col" class="px-6 py-3">
                                ID
                            </th>
                            <th scope="col" class="px-6 py-3">
                                Nome
                            </th>
                            <th scope="col" class="px-6 py-3">
                                Telefone
                            </th>
                            <th scope="col" class="px-6 py-3">
                                Cidade
                            </th>
                            <th scope="col" class="px-6 py-3">
                                Estado
                            </th>
                            <th scope="col" class="px-6 py-3">
                                Local
                            </th>
                            <th scope="col" class="px-6 py-3">
                                Categoria
                            </th>
                            <th scope="col" class="px-6 py-3">
                                IDEB23
                            </th>
                            <th scope="col" class="px-6 py-3">
                                Acões
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for escola in page_obj %}
                        <tr class="bg-neutral-primary-soft border-b border-default hover:bg-neutral-secondary-medium">
                            <th scope="row" class="px-6 py-4 font-medium text-heading whitespace-nowrap">
                                <a href="/#detalhes" class="font-medium text-blue-500 hover:underline">{{ escola.idescola }}</a>
                            </th>
                            <td class="px-6 py-4">
                                {{ escola.nome }}
                            </td>
                            <td class="px-6 py-4">
                                {{ escola.telefone|default:"-" }}
                            </td>
                            <td class="px-6 py-4">
                                {{ escola.cidade }}
                            </td>
                            <td class="px-6 py-4">
                                {{ escola.estado }}
                            </td>
                            <td class="px-6 py-4">
                                {{ escola.local }}
                            </td>
                            <td class="px-6 py-4">
                                {{ escola.categoria }}
                            </td>
                            <td class="px-6 py-4">
                                {{ escola.ideb23|default:"0.00" }}
                            </td>
                            <td class="px-6 py-4 select-none">
                                <span
                                    data-modal-target="popup-modal" data-modal-toggle="popup-modal"
                                    class="font-medium text-red-500 hover:underline cursor-pointer excluir"
                                    data-exclude="{{ escola.idescola }}" >Excluir</span>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="10" class="text-center py-4 text-gray-500">
                                Nenhum registro encontrado.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
                <nav class="flex items-center flex-column flex-wrap md:flex-row justify-between p-4"
                    aria-label="Table navigation">

                    <!-- TEXTO "EXIBINDO X–Y DE Z" -->
                    <span class="text-sm font-normal text-body mb-4 md:mb-0 block w-full md:inline md:w-auto">
                        Exibindo
                        <span class="font-semibold text-heading">
                            {{ page_obj.start_index }}-{{ page_obj.end_index }}
                        </span>
                        de
                        <span class="font-semibold text-heading">
                            {{ page_obj.paginator.count }}
                        </span>
                        registros
                    </span>

                    <ul class="flex -space-x-px text-sm">

                        {# ---------------- PREVIOUS ---------------- #}
                        {% if page_obj.has_previous %}
                        <li>
                            <a href="?{{ querystring }}&page={{ page_obj.previous_page_number }}"
                                class="flex items-center justify-center text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading font-medium rounded-s-base text-sm px-3 h-9">
                                Anterior
                            </a>
                        </li>
                        {% else %}
                        <li>
                            <span
                                class="flex items-center justify-center text-gray-400 bg-neutral-secondary-medium box-border border border-default-medium rounded-s-base text-sm px-3 h-9 cursor-not-allowed">
                                Anterior
                            </span>
                        </li>
                        {% endif %}

                        {# ---------------- NÚMEROS DA JANELA ---------------- #}
                        {% with current=page_obj.number last=page_obj.paginator.num_pages %}
                        {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.paginator.count > 0 %}
                        {% if num >= current and num < current|add:3 %} <li>
                            {% if num == current %}
                            <span aria-current="page"
                                class="flex items-center justify-center text-fg-brand bg-brand-softer box-border border border-default-medium font-medium text-sm min-w-9 p-2 h-9">
                                {{ num }}
                            </span>
                            {% else %}
                            <a href="?{{ querystring }}&page={{ num }}"
                                class="flex items-center justify-center text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium font-medium text-sm min-w-9 p-2 h-9">
                                {{ num }}
                            </a>
                            {% endif %}
                            </li>
                            {% endif %}
                            {% endif %}
                            {% endfor %}

                            {# ---------------- ELLIPSIS ---------------- #}
                            {% if current|add:3 < last %} <li>
                                <span
                                    class="flex items-center justify-center text-gray-400 box-border border border-default-medium font-medium text-sm min-w-9 p-2 h-9">
                                    ...
                                </span>
                                </li>
                                {% endif %}

                                {# ---------------- ÚLTIMA PÁGINA ---------------- #}
                                {% if current < last and last > 3 %} <li>
                                    <a href="?{{ querystring }}&page={{ last }}"
                                        class="flex items-center justify-center text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium font-medium text-sm min-w-9 p-2 h-9">
                                        {{ last }}
                                    </a>
                                    </li>
                                    {% endif %}
                                    {% endwith %}

                                    {# ---------------- NEXT ---------------- #}
                                    {% if page_obj.has_next %}
                                    <li>
                                        <a href="?{{ querystring }}&page={{ page_obj.next_page_number }}"
                                            class="flex items-center justify-center text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading font-medium rounded-e-base text-sm px-3 h-9">
                                            Próximo
                                        </a>
                                    </li>
                                    {% else %}
                                    <li>
                                        <span
                                            class="flex items-center justify-center text-gray-400 bg-neutral-secondary-medium box-border border border-default-medium rounded-e-base text-sm px-3 h-9 cursor-not-allowed">
                                            Próximo
                                        </span>
                                    </li>
                                    {% endif %}

                    </ul>
                </nav>
        </div>
    </div>
</div>
<div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
        <div class="relative bg-neutral-primary-soft border border-default rounded-base shadow-sm p-4 md:p-6">
                <button type="button" class="absolute top-3 end-2.5 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-9 h-9 ms-auto inline-flex justify-center items-center" data-modal-hide="popup-modal">
                    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/></svg>
                    <span class="sr-only">Close modal</span>
                </button>
            <div class="p-4 md:p-5 text-center">
                <svg class="mx-auto mb-4 text-fg-disabled w-12 h-12" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V8m0 8h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/></svg>
                <h3 class="mb-6 text-body">Tem certeza que deseja excluir esse registro?</h3>
                <div class="flex items-center space-x-4 justify-center">
                    <button data-modal-hide="popup-modal" type="button" id="confirm-exclude" class="text-white bg-danger box-border border border-transparent hover:bg-danger-strong focus:ring-4 focus:ring-danger-medium shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">
                        Sim
                    </button>
                    <button data-modal-hide="popup-modal" type="button" class="text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% for script in scripts %}
    <script src="{% static script %}"></script>
{% endfor %}
{% endblock %}